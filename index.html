<html lang="en">

<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="TemplateData/style.css">
    <link rel="stylesheet" href="min.css" type="text/css">
    <title> AR.js </title>
    <script src="./aframe.js"></script>
    <script src="./aframe-ar.js"></script>
    <!-- Remove if you want some more debug options -->
    <style>
        #arjsDebugUIContainer {
            display: none!important;
        }

        .a-enter-vr-button {
            display: none;
        }

        .square_btn {
            z-index: 100;
            display: inline-block;
            padding: 0.5em 1em;
            text-decoration: none;
            background: #668ad8;
            /*ボタン色*/
            color: #FFF;
            border-bottom: solid 4px #627295;
            border-radius: 3px;
        }

        .square_btn:active {
            /*ボタンを押したとき*/
            -ms-transform: translateY(4px);
            -webkit-transform: translateY(4px);
            transform: translateY(4px);
            /*下に動く*/
            border-bottom: none;
            /*線を消す*/
        }

        #filter {
            background: #000000;
            height: 100%;
            width: 100%;
            position: absolute;
            top: 0px;
            left: 0px;
            z-index: 1000;
        }
    </style>
    <script src="TemplateData/UnityProgress.js"></script>
    <script src="Build/UnityLoader.js"></script>
    <script>
        let buttonclickflag = false;
        let script;
        let editorflag = true;
        let UnityOn = false;
        let OpenJSCADOn = false;
        let OpenJSCADPolygons = new Array();
        let OpenJSCADPolygonTypes = new Array();
        var gameInstance = UnityLoader.instantiate("gameContainer", "Build/soy_simu_temp.json", { onProgress: UnityProgress });
        function buttonclick() {
            buttonclickflag = !buttonclickflag;
            if (buttonclickflag) {
                document.getElementsByClassName("square_btn")[0].innerHTML = "閉じる";
                document.getElementById("filter").style.display = "block";
                document.getElementsByClassName("webgl-content")[0].style.display = "block";
            } else {
                document.getElementsByClassName("square_btn")[0].innerHTML = "LEGO製作";
                document.getElementById("filter").style.display = "none";
                document.getElementsByClassName("webgl-content")[0].style.display = "none";
            }
        }
        function UnityAwake() {
            UnityOn = true;
            if (UnityOn && OpenJSCADOn) OpenJSCADModelTransmit();
        }

        function OpenJSCADModelTransmit() {
            for (let i = 0; i < OpenJSCADPolygons.length; i++) {
                gameInstance.SendMessage('OpenJSCADModel', 'PushVertex', OpenJSCADPolygons[i][0]);
                gameInstance.SendMessage('OpenJSCADModel', 'PushVertex', OpenJSCADPolygons[i][1]);
                gameInstance.SendMessage('OpenJSCADModel', 'PushVertex', OpenJSCADPolygons[i][2]);
            }
            for (let i = 0; i < OpenJSCADPolygonTypes.length; i++) {
                gameInstance.SendMessage('OpenJSCADModel', 'PushPolygonType', OpenJSCADPolygonTypes[i]);
            }
            gameInstance.SendMessage('OpenJSCADModel', 'MakeModel');
            OpenJSCADPolygons = new Array();
        }
    </script>
</head>

<body style='margin : 0px; overflow: hidden; height: 100%;'>
    <a-scene embedded arjs>
        <a-marker preset="hiro">
            <!-- Avert thine eyes, this ain't pretty -->
            <!-- <a-triangle color="#CCC"></a-triangle> !-->
            <!-- <a-triangle color="#FFFFFF" vertex-a="0 0 0" vertex-b="-1 -1 0" vertex-c="-1 0 0"></a-triangle> -->
            <a-triangle color="#FFFFFF" vertex-a="-0.25 -0.25 0" vertex-b="-0.25 -0.25 0.5" vertex-c="-0.25 0.25 0.5"></a-triangle>
            <a-triangle color="#FFFFFF" vertex-a="-0.25 -0.25 0" vertex-b="-0.25 0.25 0.5" vertex-c="-0.25 0.25 0"></a-triangle>
            <a-triangle color="#FFFFFF" vertex-a="0.25 -0.25 0" vertex-b="0.25 0.25 0" vertex-c="0.25 0.25 0.5"></a-triangle>
            <a-triangle color="#FFFFFF" vertex-a="0.25 -0.25 0" vertex-b="0.25 0.25 0.5" vertex-c="0.25 -0.25 0.5"></a-triangle>
            <a-triangle color="#FFFFFF" vertex-a="-0.25 -0.25 0" vertex-b="0.25 -0.25 0" vertex-c="0.25 -0.25 0.5"></a-triangle>
            <a-triangle color="#FFFFFF" vertex-a="-0.25 -0.25 0" vertex-b="0.25 -0.25 0.5" vertex-c="-0.25 -0.25 0.5"></a-triangle>
            <a-triangle color="#FFFFFF" vertex-a="-0.25 0.25 0" vertex-b="-0.25 0.25 0.5" vertex-c="0.25 0.25 0.5"></a-triangle>
            <a-triangle color="#FFFFFF" vertex-a="-0.25 0.25 0" vertex-b="0.25 0.25 0.5" vertex-c="0.25 0.25 0"></a-triangle>
            <a-triangle color="#FFFFFF" vertex-a="-0.25 -0.25 0" vertex-b="-0.25 0.25 0" vertex-c="0.25 0.25 0"></a-triangle>
            <a-triangle color="#FFFFFF" vertex-a="-0.25 -0.25 0" vertex-b="0.25 0.25 0" vertex-c="0.25 -0.25 0"></a-triangle>
            <a-triangle color="#FFFFFF" vertex-a="-0.25 -0.25 0.5" vertex-b="0.25 -0.25 0.5" vertex-c="0.25 0.25 0.5"></a-triangle>
            <a-triangle color="#FFFFFF" vertex-a="-0.25 -0.25 0.5" vertex-b="0.25 0.25 0.5" vertex-c="-0.25 0.25 0.5"></a-triangle>
        </a-marker>
        <a-entity camera> </a-entity>
    </a-scene>

    <script src="dist/min.js"></script>
    <!-- setup display of the errors as required by OpenJSCAD.js -->
    <div class="jscad-container">
        <div id="header">
            <div id="errordiv">hello</div>
        </div>

        <!-- setup display of the viewer, i.e. canvas -->
        <div oncontextmenu="return false;" id="viewerContext" design-url="totte.jscad"></div>

        <!-- setup display of the status, as required by OpenJSCAD.js -->
        <!-- set display: block to display this -->
        <div id="tail" style="display: block;">
            <div id="statusdiv"></div>
        </div>
    </div>
    <div id="editor" style="width: 600px; height: 600px; position: absolute; top: 0px; right: 0px; z-index: 3; opacity:0.5;"></div>
    <script src="./ace.js"></script>
    <script>
        let editor = ace.edit("editor");
        editor.on("change", function (e) {
            document.getElementById('updateButton').click();
        });
    </script>

    <div class="webgl-content" style="z-index: 2000; position: absolute; top: 50%; left: 50%; display: none;">
        <div id="gameContainer" style="width: 960px; height: 600px"></div>
    </div>
    <a href="#" class="square_btn" style="position: absolute; right: 10px; bottom: 10px; z-index: 2000;" onclick="buttonclick();">LEGO製作</a>
    <div id="filter" style="display: none;"></div>
</body>

</html>