<html lang="en">

<head>
    <link rel="stylesheet" href="min.css" type="text/css">
    <title> AR.js </title>
    <script src="./aframe.js"></script>
    <script src="./aframe-ar.js"></script>
    <!-- Remove if you want some more debug options -->
    <style>
        #arjsDebugUIContainer {
            display: none!important;
        }

        .a-enter-vr-button {
            display: none;
        }
    </style>
    <script src="TemplateData/UnityProgress.js"></script>
    <script src="Build/UnityLoader.js"></script>
    <script>
        let script;
        let editorflag = true;
        let UnityOn = false;
        let OpenJSCADOn = false;
        let OpenJSCADPolygons = new Array();
        let OpenJSCADPolygonTypes = new Array();
        var gameInstance = UnityLoader.instantiate("gameContainer", "Build/soy_simu_temp.json", { onProgress: UnityProgress });
        function UnityAwake() {
            UnityOn = true;
            if (UnityOn && OpenJSCADOn) OpenJSCADModelTransmit();
        }

        function OpenJSCADModelTransmit() {
            for (let i = 0; i < OpenJSCADPolygons.length; i++) {
                gameInstance.SendMessage('OpenJSCADModel', 'PushVertex', OpenJSCADPolygons[i][0]);
                gameInstance.SendMessage('OpenJSCADModel', 'PushVertex', OpenJSCADPolygons[i][1]);
                gameInstance.SendMessage('OpenJSCADModel', 'PushVertex', OpenJSCADPolygons[i][2]);
            }
            for (let i = 0; i < OpenJSCADPolygonTypes.length; i++) {
                gameInstance.SendMessage('OpenJSCADModel', 'PushPolygonType', OpenJSCADPolygonTypes[i]);
            }
            gameInstance.SendMessage('OpenJSCADModel', 'MakeModel');
            OpenJSCADPolygons = new Array();
        }
    </script>
</head>

<body style='margin : 0px; overflow: hidden;'>
    <a-scene embedded arjs>
        <a-marker preset="hiro">
            <!-- Avert thine eyes, this ain't pretty -->
            <!-- <a-triangle color="#CCC"></a-triangle> !-->
            <!-- <a-triangle color="#FFFFFF" vertex-a="0 0 0" vertex-b="-1 -1 0" vertex-c="-1 0 0"></a-triangle> -->
            <a-triangle color="#FFFFFF" vertex-a="-0.25 -0.25 0" vertex-b="-0.25 -0.25 0.5" vertex-c="-0.25 0.25 0.5"></a-triangle>
            <a-triangle color="#FFFFFF" vertex-a="-0.25 -0.25 0" vertex-b="-0.25 0.25 0.5" vertex-c="-0.25 0.25 0"></a-triangle>
            <a-triangle color="#FFFFFF" vertex-a="0.25 -0.25 0" vertex-b="0.25 0.25 0" vertex-c="0.25 0.25 0.5"></a-triangle>
            <a-triangle color="#FFFFFF" vertex-a="0.25 -0.25 0" vertex-b="0.25 0.25 0.5" vertex-c="0.25 -0.25 0.5"></a-triangle>
            <a-triangle color="#FFFFFF" vertex-a="-0.25 -0.25 0" vertex-b="0.25 -0.25 0" vertex-c="0.25 -0.25 0.5"></a-triangle>
            <a-triangle color="#FFFFFF" vertex-a="-0.25 -0.25 0" vertex-b="0.25 -0.25 0.5" vertex-c="-0.25 -0.25 0.5"></a-triangle>
            <a-triangle color="#FFFFFF" vertex-a="-0.25 0.25 0" vertex-b="-0.25 0.25 0.5" vertex-c="0.25 0.25 0.5"></a-triangle>
            <a-triangle color="#FFFFFF" vertex-a="-0.25 0.25 0" vertex-b="0.25 0.25 0.5" vertex-c="0.25 0.25 0"></a-triangle>
            <a-triangle color="#FFFFFF" vertex-a="-0.25 -0.25 0" vertex-b="-0.25 0.25 0" vertex-c="0.25 0.25 0"></a-triangle>
            <a-triangle color="#FFFFFF" vertex-a="-0.25 -0.25 0" vertex-b="0.25 0.25 0" vertex-c="0.25 -0.25 0"></a-triangle>
            <a-triangle color="#FFFFFF" vertex-a="-0.25 -0.25 0.5" vertex-b="0.25 -0.25 0.5" vertex-c="0.25 0.25 0.5"></a-triangle>
            <a-triangle color="#FFFFFF" vertex-a="-0.25 -0.25 0.5" vertex-b="0.25 0.25 0.5" vertex-c="-0.25 0.25 0.5"></a-triangle>
        </a-marker>
        <a-entity camera> </a-entity>
    </a-scene>

    <script src="dist/min.js"></script>
    <!-- setup display of the errors as required by OpenJSCAD.js -->
    <div class="jscad-container">
        <div id="header">
            <div id="errordiv">hello</div>
        </div>

        <!-- setup display of the viewer, i.e. canvas -->
        <div oncontextmenu="return false;" id="viewerContext" design-url="totte.jscad"></div>

        <!-- setup display of the status, as required by OpenJSCAD.js -->
        <!-- set display: block to display this -->
        <div id="tail" style="display: none;">
            <div id="statusdiv"></div>
        </div>
    </div>
    <div id="editor" style="width: 600px; height: 600px; position: absolute; top: 0px; right: 0px; z-index: 3; opacity:0.5;"></div>
    <script src="./ace.js"></script>
    <script>
        let editor = ace.edit("editor");
        editor.on("change", function (e) {
            document.getElementById('updateButton').click();
        });
    </script>

    <div class="webgl-content" style="z-index: 100; position: absolute; top: 0px; left: 0px;">
        <div id="gameContainer" style="width: 960px; height: 600px"></div>
        <div class="footer">
            <div class="webgl-logo"></div>
            <div class="fullscreen" onclick="gameInstance.SetFullscreen(1)"></div>
            <div class="title">UnityModelViewer</div>
        </div>
    </div>

</body>

</html>